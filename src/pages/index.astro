---
import Layout from "../layouts/Layout.astro";
import { useCloud } from "freestyle-sh";
import { FeatureRequestsListCS } from "../cloudstate/feature-requests";
import { configureFreestyle } from "freestyle-sh";
import type { FeatureRequestsAppCS } from "$lib/cloudstate/app";
import FeatureRequests from "$lib/components/FeatureRequests.svelte";
import App from "$lib/components/UserProfile.svelte";

configureFreestyle({
  createHeaders: () => Astro.request.headers,
});

const featureRequestsCS = useCloud<typeof FeatureRequestsListCS>(
  "feature-requests-list"
);
const app = useCloud<typeof FeatureRequestsAppCS>("feature-requests-app");

const featureRequets = await featureRequestsCS.getRequests();
const user = await app.getUserInfo();
---

<Layout title="Freestyle Astro">
  <main>
    <div>
      <div class="border-b py-3 flex justify-between px-4 items-center">
        Freestyle Feature Requests
        <App user={user} client:load />
      </div>
      <FeatureRequests client:load featureRequests={featureRequets} />
    </div>
  </main>
</Layout>
